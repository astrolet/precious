<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>ephemeris.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  
  <div class='section'>
    <div class='docs'><h1>ephemeris.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Used to obtain data from the <a href="http://www.astro.com/swisseph">Swiss Ephemeris</a>.<br/>
More easily invoked with <a href="http://astrolin.com/to/eden">Eden</a>,
which also offers extra output options.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Borrowed from http://stackoverflow.com/a/6098238 - insert this directory
to the sys.path front - imports the local swisseph rather than any other
that may be otherwise installed on the system (for better predictability).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">inspect</span>
<span class="n">ot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">if</span> <span class="n">ot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ot</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">swisseph</span> <span class="kn">as</span> <span class="nn">swe</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Expects json as the first and only argument, containing instructions about what is needed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
  <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; is useless without input&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Could not load JSON object from argv[1]: &quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Rarely used, pprint is imported only upon such request for output.
It also substitutes swe.get_planet_name - can be handy on occasion.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="s">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">re</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;out&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;pprint&quot;</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>This is a minimal e[phemeris].</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">e</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;0&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&quot;1&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&quot;2&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&quot;3&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&quot;4&quot;</span><span class="p">:</span> <span class="p">[]}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Zero hash for extra data -- useful with post-processing.
Preserves the input request if asked for it (with "re").
Possibly also debug data, time metrics, etc.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s">&quot;extra&quot;</span> <span class="ow">in</span> <span class="n">re</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;extra&quot;</span><span class="p">]:</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;extra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">add</span> <span class="o">==</span> <span class="s">&quot;re&quot;</span><span class="p">:</span>
          <span class="n">e</span><span class="p">[</span><span class="s">&quot;0&quot;</span><span class="p">][</span><span class="n">add</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">del</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;0&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>The data files, which may not be in the
<a href="https://github.com/astrolet/sin">sin repo</a> /
<a href="http://search.npmjs.org/#/gravity">gravity pakage</a>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">swe</span><span class="o">.</span><span class="n">set_ephe_path</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Is using the Gregorian calendar flag correct?
If calendar type is conditional, is it easier to determine here (with the help of swe)?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">t</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">utc_to_jd</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>
                      <span class="n">re</span><span class="p">[</span><span class="s">&quot;ut&quot;</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <!---
e["jd-ut1"] = swe.jdut1_to_utc(t[1], 1)
--->

<p>Ask for what is precious:</p>
<ol>
<li>majors (the main things / points for astrology)</li>
<li>minors (other objects - e.g. some "minor planets")</li>
<li>angles (ascmc) = 8 of 10 doubles (unused 8 &amp; 9)</li>
<li>houses (cusps) = 12 of 13 doubles (unused zero)</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">[{</span><span class="s">&quot;what&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;what&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">}]:</span>
      <span class="n">iterate</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;stuff&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s">&quot;what&quot;</span><span class="p">])]</span>
      <span class="k">if</span> <span class="n">iterate</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">iterate</span><span class="p">:</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s">&quot;offset&quot;</span><span class="p">]))</span>
          <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;stuff&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">output</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">out</span><span class="p">]</span>
          <span class="n">e</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s">&quot;what&quot;</span><span class="p">]][</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">e</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s">&quot;what&quot;</span><span class="p">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>The angles &amp; houses are possible only if given geo location.
For that, the latitude and longitude must set - to float, or
be able to convert to float (e.g. from string or perhaps int).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="s">&quot;geo&quot;</span> <span class="ow">in</span> <span class="n">re</span>
         <span class="ow">and</span> <span class="s">&quot;lat&quot;</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">]</span>
         <span class="ow">and</span> <span class="s">&quot;lon&quot;</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">]</span>
         <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">][</span><span class="s">&quot;lat&quot;</span><span class="p">]</span>
         <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">][</span><span class="s">&quot;lon&quot;</span><span class="p">]):</span>
      <span class="n">e</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">][</span><span class="s">&quot;lat&quot;</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s">&quot;geo&quot;</span><span class="p">][</span><span class="s">&quot;lon&quot;</span><span class="p">]),</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s">&quot;houses&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&quot;W&quot;</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>The Whole Sign default wasn't asked for.
None (null) or false means no houses wanted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;houses&quot;</span><span class="p">]:</span>
        <span class="k">del</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">del</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;3&quot;</span><span class="p">]</span>
      <span class="k">del</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Print to STDOUT.
JSON is the default (not even checked).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">out</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s">&quot;out&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">re</span> <span class="k">else</span> <span class="s">&quot;json&quot;</span>
    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&quot;print&quot;</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&quot;pprint&quot;</span><span class="p">:</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&quot;1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">}</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">replace</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">what</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
          <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">what</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">replace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_planet_name</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
          <span class="n">e</span><span class="p">[</span><span class="n">what</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace</span>
      <span class="n">pprint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Necessary when called from Node / Eden.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
